Чтобы создать критическую секцию, необходимо обеспечить отсутствие реордерига между операциями, находящимися внутри и снаружи.
Поэтому в lock необходимо поставить memory_order_acquire, запрещающий реордеринг последующих операции,
а в unlock - memory_order_release, запрещающий реордеринг предыдущих операций. Этого достаточно, чтобы операции внутри критической секции
не оптимизировались и не выходили за ее пределы.

В случае volatile-переменных можно поставить ничего не делающий барьер memory_order_relaxed, так как волатильность переменной говорит
о том, что все операции с ней не будут оптимизироваться.
